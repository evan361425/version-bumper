{
  "title": "Bumper JSON configuration",
  "$schema": "http://json-schema.org/draft-04/schema#",

  "properties": {
    "repoLink": {
      "type": "string",
      "title": "Changelog 中會作為 tag 的連結",
      "description": "預設使用 `git remote get-url origin` 的輸出，\n若無則為 `https://github.com/example/example`"
    },
    "prOnly": {
      "type": "boolean",
      "default": false,
      "title": "根據設定只建立 PR 而不做任何升版",
      "description": "通常需要重新建立 PR 的時候會用到"
    },
    "releaseOnly": {
      "type": "boolean",
      "default": false,
      "title": "根據設定只建立 Release 而不做任何升版",
      "description": "只會建立 pre-release"
    },
    "commit": {
      "type": "object",
      "description": "Commit 相關設定",
      "properties": {
        "message": {
          "cliName": "commitMessage",
          "type": "string",
          "default": "chore: bump to {version}",
          "title": "每次升版的 commit 訊息",
          "description": "支援的變數有：\n`version`、`ticket`、`stage`"
        },
        "noPush": {
          "cliName": "commitNoPush",
          "type": "boolean",
          "default": false,
          "title": "是否把 Commit 推至 remote repo",
          "description": "這裡包括自動打的 tag"
        }
      }
    },
    "changelog": {
      "type": "object",
      "additionalProperties": false,
      "title": "針對 Changelog 的設定",
      "properties": {
        "disable": {
          "cliName": "changelogDisable",
          "type": "boolean",
          "default": false,
          "title": "不對 Changelog 做任何事"
        },
        "ticketPrefix": {
          "cliName": "changelogTicketPrefix",
          "type": "string",
          "default": "票號：",
          "title": "在 Changelog 中票號的前綴詞",
          "description": "如果有給票號，\n在 Changelog 中每個版本的資訊中都會有票的訊息，\n這就是其的前綴。"
        },
        "header": {
          "cliName": "changelogHeader",
          "type": "string",
          "default": "# Changelog\n\n所有本專案的版本紀錄將於此說明之\n\n文件依照 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) 內所描述的格式撰寫，版本號碼依照 [Semantic Versioning](https://semver.org/spec/v2.0.0.html)。",
          "title": "Changelog 的標題",
          "description": "在這之後就是 unreleased 的資訊。"
        }
      }
    },
    "files": {
      "type": "object",
      "additionalProperties": false,
      "title": "相關文件的位置",
      "properties": {
        "changelog": {
          "cliName": "fileChangelog",
          "type": "string",
          "default": "CHANGELOG.md",
          "title": "Changelog 位置"
        },
        "latestVersion": {
          "cliName": "fileLatestVersion",
          "type": "string",
          "default": "docs/LATEST_VERSION.md",
          "title": "最新版本的內文位置",
          "description": "其中的票號會被 `autoLinks` 自動補上連結。\n支援的 metadata 有：version, ticket"
        },
        "prTemplate": {
          "cliName": "filePrTemplate",
          "type": "string",
          "default": "docs/PR_TEMPLATE.md",
          "title": "PR 文本的位置",
          "description": "支援的變數有：\nversion, ticket, stage 這個 PR 的 branches key, content 最新版本的內文, diff 連結"
        }
      }
    },
    "autoLinks": {
      "type": "object",
      "additionalProperties": false,
      "description": "用來對票號自動補上連結",
      "patternProperties": {
        "^[a-zA-Z-]+$": {
          "type": "string",
          "title": "票號前綴對上連結模板",
          "description": "只支援 a-z, A-Z 和 - 作為鍵，\n支援變數：\n<num> 來用做票號。例如 `TICKET-`（不分大小寫）對上 `https://example/ticket-<num>?k=v`，\n就會把 tIcKet-123 轉成 https://example/tIcKet-123?k=v"
        }
      },
      "cli": {
        "autoLinkKeys": {
          "title": "票號前綴",
          "description": "以逗號（,）做為區隔，\n每個值只支援 a-z, A-Z 和 -"
        },
        "autoLinkValues": {
          "title": "連結模板",
          "description": "以逗號（,）做為區隔，\n照順序對應 `autoLinkKeys`，\n支援變數：\n<num> 來用做票號"
        }
      }
    },
    "release": {
      "type": "object",
      "additionalProperties": false,
      "description": "用來設定 GitHub Release",
      "properties": {
        "preRelease": {
          "cliName": "releasePre",
          "type": "boolean",
          "default": false,
          "title": "標示為 pre-release"
        },
        "draft": {
          "cliName": "releaseDraft",
          "type": "boolean",
          "default": false,
          "title": "標示為 draft"
        }
      }
    },
    "tags": {
      "type": "object",
      "title": "Tag 的設定",
      "patternProperties": {
        "^[a-zA-Z\\-_0-9]+$": {
          "type": "object",
          "additionalProperties": false,
          "description": "鍵值只是代表名稱",
          "required": ["pattern"],
          "properties": {
            "pattern": {
              "type": "string",
              "title": "這個 Tag 對應的版本號模式",
              "description": "會使用 `latestVersion` 來最為版本資訊，\n例如 staging 環境的標籤模式可能為 `v\\d+.\\d+.\\d+-rc\\d*`"
            },
            "changelog": {
              "type": "boolean",
              "default": false,
              "title": "當這個 Tag 被觸發時，修改 Changelog",
              "description": "如果 `prOnly` 為是，則不會去改 Changelog"
            }
          }
        }
      },
      "cli": {
        "tagNames": {
          "title": "Tag 名稱",
          "description": "以逗號（,）做為區隔，必須每個都有值"
        },
        "tagPatterns": {
          "title": "Tag 的版本模式",
          "description": "以逗號（,）做為區隔，\n例如 `^v\\d+.\\d+.\\d+-rc\\d*$,^v\\d+.\\d+.\\d+$`\n必須每個都有值"
        },
        "tagChangelogs": {
          "title": "Tag 是否要去修改 Changelog",
          "description": "以逗號（,）做為區隔，有任一值則為 true"
        }
      },
      "additionalProperties": false
    },
    "pr": {
      "type": "object",
      "title": "PR 的設定",
      "properties": {
        "repo": {
          "cliName": "prRepo",
          "type": "string",
          "title": "要開 PR 的 Repo",
          "description": "預設是用 `repoLink` 的值，\n例如：`example/example`"
        },
        "branches": {
          "type": "object",
          "title": "PR 的分支管理",
          "patternProperties": {
            "^[a-zA-Z\\-_0-9]+$": {
              "type": "object",
              "additionalProperties": false,
              "description": "鍵值只是代表名稱",
              "required": ["base"],
              "properties": {
                "base": {
                  "type": "string",
                  "title": "做 PR 時的來源分支",
                  "description": "需要為 git 上的名稱，\n例如 `production` 的 base 可能為 `deploy/staging`"
                },
                "head": {
                  "type": "string",
                  "title": "做 PR 時的目標分支",
                  "default": "deploy/{name}",
                  "description": "需要為 git 上的名稱，\n例如 `production` 的 head 可能為 `deploy/production`"
                },
                "reviewers": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": { "type": "string" },
                  "title": "發 PR 時的 reviewers",
                  "description": "不可以重複"
                },
                "siblings": {
                  "type": "object",
                  "patternProperties": {
                    "[a-zA-Z\\-_/0-9]": {
                      "type": "object",
                      "properties": {
                        "base": { "type": "string" },
                        "head": { "type": "string" },
                        "labels": {
                          "type": "array",
                          "items": { "type": "string" }
                        },
                        "reviewers": {
                          "type": "array",
                          "items": { "type": "string" }
                        }
                      }
                    }
                  },
                  "title": "發 PR 時會一起發的額外 PR",
                  "description": "這是為了 DR 環境而設計的，例如線上環境要同時開 DR 的 PR\n其設定會繼承所有父系設定"
                },
                "labels": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": { "type": "string" },
                  "title": "發 PR 時的 labels",
                  "description": "不可以重複"
                }
              }
            }
          },
          "cli": {
            "branchNames": {
              "title": "分支名稱",
              "description": "以逗號（,）做為區隔，必須每個都有值\n需要和 Tag 的名稱對齊"
            },
            "branchBases": {
              "title": "做 PR 時的來源分支",
              "description": "以逗號（,）做為區隔，必須每個都有值"
            },
            "branchHeads": {
              "title": "做 PR 時的目標分支",
              "default": "deploy/{name}",
              "description": "以逗號（,）做為區隔"
            },
            "branchReviewers": {
              "title": "做 PR 時的 reviewers",
              "description": "以逗號（,）做為區隔不同分支，\n再以斜線（/）區分不同 reviewer，\n例如 `stag-rev,prod-rev1/prod-rev2`"
            },
            "branchLabels": {
              "title": "做 PR 時的 labels",
              "description": "以逗號（,）做為區隔不同分支，\n再以空白（ ）區分不同 label，\n例如 `stag-label,prod-label1 prod-label2`"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "latestVersion": {
      "type": "string",
      "title": "最新版本號",
      "description": "不建議設定於此，\n請在 `files.latestVersion` 中透過 metadata 注入。"
    },
    "latestTicket": {
      "type": "string",
      "title": "最新票號",
      "description": "不建議設定於此，\n請在 `files.latestVersion` 中透過 metadata 注入。"
    },
    "latestContent": {
      "type": "string",
      "title": "最新版本的內文",
      "description": "不建議設定於此，\n請寫在 `files.latestVersion`。"
    },
    "deps": {
      "type": "object",
      "title": "更新套件相關設定",
      "additionalProperties": false,
      "properties": {
        "ignored": {
          "type": "array",
          "title": "忽略哪些相依套件",
          "description": "套件全名或者以 `*` 結尾代表以此開頭的套件",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "title": "套件名稱"
          },
          "cli": {
            "ignored": {
              "title": "忽略哪些相依套件",
              "description": "以逗號（,）做為區隔，\n各值為套件全名或者以 `*` 結尾代表以此開頭的套件"
            }
          }
        },
        "output": {
          "type": "string",
          "title": "更新時，版本資訊的寫入位置",
          "description": "Markdown 格式，\n無預設，所以沒給就不會寫"
        },
        "appendOnly": {
          "type": "boolean",
          "default": false,
          "title": "更新檔案至 `deps.output` 時，用附加的方式"
        },
        "useExact": {
          "type": "boolean",
          "default": false,
          "title": "更新套件時不要加 `^` 在前綴"
        },
        "latestDeps": {
          "type": ["array", "string"],
          "title": "使用 latest 的版本而不是 wanted 的套件",
          "description": "各值為套件全名或者以 `*` 結尾代表以此開頭的套件\n若陣列中有一個值為 `*` 代表全部的套件都使用 latestDeps",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "title": "套件名稱"
          },
          "cli": {
            "latestDeps": {
              "title": "使用 latest 的版本而不是 wanted 的套件",
              "description": "以逗號（,）做為區隔，\n各值為套件全名或者以 `*` 結尾代表以此開頭的套件\n若陣列中有一個值為 `*` 代表全部的套件都使用 latestDeps"
            }
          }
        },
        "preCommands": {
          "type": "array",
          "title": "在安裝套件前的指令",
          "description": "各值代表一個 sub-process 的指令",
          "items": {
            "type": ["string", "array"],
            "title": "若為陣列，則每個值代表該指令的參數",
            "items": {
              "type": "string"
            }
          },
          "cli": {
            "preCommands": {
              "title": "在安裝套件前的指令",
              "description": "以逗號（,）做為區隔，\n各值代表一個 sub-process 的指令"
            }
          }
        },
        "postCommands": {
          "type": "array",
          "title": "在安裝套件後的指令",
          "description": "各值代表一個 sub-process 的指令",
          "items": {
            "type": ["string", "array"],
            "title": "若為陣列，則每個值代表該指令的參數",
            "items": {
              "type": "string"
            }
          },
          "cli": {
            "postCommands": {
              "title": "在安裝套件後的指令",
              "description": "以逗號（,）做為區隔，\n各值代表一個 sub-process 的指令"
            }
          }
        },
        "dev": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "oneByOne": {
              "type": "boolean",
              "default": false,
              "title": "更新開發套件時是否一次只更新一個套件"
            },
            "preCommands": {
              "type": "array",
              "title": "在安裝開發套件前的指令",
              "description": "預設使用 `deps.preCommands`，各值代表一個 sub-process 的指令",
              "items": {
                "type": ["string", "array"],
                "title": "若為陣列，則每個值代表該指令的參數",
                "items": {
                  "type": "string"
                }
              },
              "cli": {
                "devPreCommands": {
                  "title": "在安裝開發套件前的指令",
                  "default": "使用 `deps.preCommands`",
                  "description": "以逗號（,）做為區隔，\n各值代表一個 sub-process 的指令"
                }
              }
            },
            "postCommands": {
              "type": "array",
              "title": "在安裝開發套件後的指令",
              "description": "預設使用 `deps.postCommands`，各值代表一個 sub-process 的指令",
              "items": {
                "type": ["string", "array"],
                "title": "若為陣列，則每個值代表該指令的參數",
                "items": {
                  "type": "string"
                }
              },
              "cli": {
                "devPostCommands": {
                  "title": "在安裝開發套件後的指令",
                  "default": "使用 `deps.postCommands`",
                  "description": "以逗號（,）做為區隔，\n各值代表一個 sub-process 的指令"
                }
              }
            }
          }
        }
      }
    }
  }
}
